<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Library</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('df/dd5/DetectorsRaw.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Raw data tools</h1>
<h2>HBFUtil</h2>
<p>Utility class for interaction record -&gt; HBF conversion and sampling of IRs for which the HBF RDH should be added to the raw data from the CRU. Should be used for MC-&gt;raw conversion to ensure that:</p>
<ul>
<li>all detectors set the HBF and TF flags in a synchronized way</li>
<li>all TFs are complete (contain nominal /D=256/ number of HBFs with contiguously incremeneting orbit numbers): for any given <code>payloadIR</code> (InteractionRecord = orbit/bc) for which payload is being created, <div class="fragment"><div class="line"><span class="keyword">using</span> IR = <a class="code" href="../../d1/d21/structo2_1_1InteractionRecord.html">o2::InteractionRecord</a>;</div><div class="line">HBFUtil::fillHBIRvector(std::vector&lt;IR&gt;&amp; dst, <span class="keyword">const</span> IR&amp; fromIR, <span class="keyword">const</span> IR&amp; payLoadIR);</div></div><!-- fragment --> will fill the provided <code>dst</code> vector with the IR's (between <code>fromIR</code> and <code>payLoadIR</code>) for which the HBFs should be generated and flushed to raw data <b>before</b> filling the payload of <code>payLoadIR</code>.</li>
</ul>
<p>See <code><a class="el" href="../../dd/d85/testHBFUtils_8cxx.html">Detectors/Raw/test/testHBFUtils.cxx</a></code> for details of usage of this class (also check the jira ticket about the <a href="https://alice.its.cern.ch/jira/browse/O2-972">MC-&gt;Raw conversion</a>).</p>
<h2>RawFileReader</h2>
<p><a class="el" href="../../d2/d88/classA.html">A</a> class for parsing raw data file(s) with "variable-size" CRU format. For very encountered link the DPL <code>SubSpecification</code> is assigned according to the formula used by DataDistribution: </p><div class="fragment"><div class="line">SubSpec = (<a class="code" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html">RDH</a>.<a class="code" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html#a6a60bb796177863c67a8342731055c14">cruID</a>&lt;&lt;16) | ((<a class="code" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html">RDH</a>.<a class="code" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html#a1603fc8ef36d5d19b856208adc6477fe">linkID</a> + 1)&lt;&lt;(<a class="code" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html">RDH</a>.<a class="code" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html#a123b62467cd61ed5f8753c30bd9d9d02">endPointID</a> == 1 ? 8 : 0)); </div></div><!-- fragment --><p> This <code>SubSpecification</code> is used to define the DPL InputSpecs (and match the OutputSpecs). <a class="el" href="../../d2/d88/classA.html">A</a> <code>FATAL</code> will be produced if 2 different link (i.e. with different <a class="el" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html#ad297efc4595998e07ee40fc82473b682" title="bit 16 to 31: block length ">RDH.feeId</a>) will be found to have the same SubSpec (i.e. the same cruID, linkID and PCIe EndPoint). Also, a <code>FATAL</code> is produced if the block expected to be a RDH fails to be recognized as RDH.</p>
<p>TODO <em>At the moment only preprocissing part of input files (used in the o2-raw-filecheck descibed below) is operational. The parsing to STF is in development</em>.</p>
<h2>Raw data file checker (standalone executable)</h2>
<div class="fragment"><div class="line">Usage:   <a class="code" href="../../d4/d7c/namespaceo2.html">o2</a>-raw-filecheck [options] file0 [... fileN]</div><div class="line"><a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html#acda743ee0581ee4ad2f506fffe2cfc08">Options</a>:</div><div class="line">  -h [ --help ]                     print <span class="keyword">this</span> help <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af3cf048e9a0729113495a358f675a111">message</a>.</div><div class="line">  -v [ --verbosity ] arg (=0)       1: print <a class="code" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html">RDH</a> on error, 2: print all <a class="code" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html">RDH</a></div><div class="line">  -<a class="code" href="../../d8/de9/qconfigoptions_8h.html#adb1f4e88682fac0faac902578cad8b6c">s</a> [ --spsize    ] arg (=1048576) nominal super-page <a class="code" href="../../d8/dde/namespaceGPUCA__NAMESPACE_1_1gpu.html#a936e7e1d3f59c6e9a0301dc3b4a1c436">size</a> in bytes</div><div class="line">  -<a class="code" href="../../d8/de9/qconfigoptions_8h.html#aa4c73b6416f57a94408b0334e6fc1ff0">t</a> [ --hbfpertf  ] arg (=256)     nominal number <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html">of</a> HBFs per <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a632fb3c4852a7511229017553bf7dc32">TF</a></div></div><!-- fragment --><p>Allows to check the correctness of CRU data (real or simulated) stored in the binary file. Multiple files can be checked, with each file containing data for the same or distinct group of links.</p>
<p>Apart from the eventual <code>FATAL</code> produced for unrecognizable RDH or 2 links with the same cruID, linkID and PCIe EndPoint but different feeId (see <code>RawFileReader</code>), the following errors are reported (as <code>ERROR</code>) for every GBT link while scanning each file (the error counter of each link is incremented for any of this errors):</p>
<ul>
<li>RawDataHeader packet counter (<code><a class="el" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html#a8e718af75fac42d758060834390cd3d8" title="bit 96 to 103: link id ">RDH.packetCounter</a></code>) is not incremented by 1</li>
<li>RawDataHeader page counter (<code><a class="el" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html#a538d9f155166ed65fda2c60ccb6b71c9" title="bit 0 to 7: stop code ">RDH.pageCnt</a></code>) is not incremented by 1</li>
<li>New HBF starts with <code><a class="el" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html#a538d9f155166ed65fda2c60ccb6b71c9" title="bit 0 to 7: stop code ">RDH.pageCnt</a> &gt; 0</code></li>
<li><code><a class="el" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html#a1fbedff37e28c01280b5c4a7332e0c12" title="bit 48 to 63: par ">RDH.stop</a></code> is set at the very 1st page of the HBF</li>
<li>New HBF starts while the previous one was not yet closed (no page <code><a class="el" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html#a1fbedff37e28c01280b5c4a7332e0c12" title="bit 48 to 63: par ">RDH.stop</a> = 1</code> received)</li>
<li>Number of HBFs in TF differs from the nominal (D=256, can be imposed by user)</li>
<li>The orbit/BC of the new HBF does not differ from previous one by 1 orbit exactly</li>
<li>New TF starts not from the beginning of the CRU SuperPage (not reported for single-link files since in that case there is no way delimit a superpage)</li>
</ul>
<p>After scanning each file, for every link the largest SuperPage size (as the size of the largest contiguos block containing data of this link). <a class="el" href="../../d2/d88/classA.html">A</a> warning is printed if this size exceeds the nominal SuperPage size (D=1MB, can be imposed by user).</p>
<p>For the correct data the output should look like this: </p><div class="fragment"><div class="line"><a class="code" href="../../d4/d7c/namespaceo2.html">o2</a>-raw-filecheck ALPIDE_DATA/rawits_pseudoCalib_RU46_49.bin </div><div class="line">[INFO] RawDataHeader v4 is assumed</div><div class="line">[INFO] #0: 182108928 bytes scanned, 69552 <a class="code" href="../../d8/d47/structo2_1_1header_1_1RAWDataHeaderV4.html">RDH</a> read <span class="keywordflow">for</span> 12 links from ALPIDE_DATA/rawits_pseudoCalib_RU46_49.bin</div><div class="line"></div><div class="line"><a class="code" href="../../d1/d4a/structSummary.html">Summary</a> <a class="code" href="../../dd/d8d/namespaceo2_1_1framework.html">of</a> preprocessing:</div><div class="line">L0   | Spec:0x3014657  FEE:0x2012 CRU:  46 Lnk:  0 EP:0 | SPages:   8 Pages:  4296 TFs:     8 with   2048 HBF in    8 blocks (0 err)</div><div class="line">L1   | Spec:0x3014658  FEE:0x2112 CRU:  46 Lnk:  1 EP:0 | SPages:   8 Pages:  4296 TFs:     8 with   2048 HBF in    8 blocks (0 err)</div><div class="line">L2   | Spec:0x3014659  FEE:0x2212 CRU:  46 Lnk:  2 EP:0 | SPages:   8 Pages:  4296 TFs:     8 with   2048 HBF in    8 blocks (0 err)</div><div class="line">L3   | Spec:0x3080193  FEE:0x2013 CRU:  47 Lnk:  0 EP:0 | SPages:   8 Pages:  4296 TFs:     8 with   2048 HBF in    8 blocks (0 err)</div><div class="line">L4   | Spec:0x3080194  FEE:0x2113 CRU:  47 Lnk:  1 EP:0 | SPages:   8 Pages:  4296 TFs:     8 with   2048 HBF in    8 blocks (0 err)</div><div class="line">L5   | Spec:0x3080195  FEE:0x2213 CRU:  47 Lnk:  2 EP:0 | SPages:   8 Pages:  4296 TFs:     8 with   2048 HBF in    8 blocks (0 err)</div><div class="line">L6   | Spec:0x3145729  FEE:0x3000 CRU:  48 Lnk:  0 EP:0 | SPages:  31 Pages:  7096 TFs:     8 with   2048 HBF in   31 blocks (0 err)</div><div class="line">L7   | Spec:0x3145730  FEE:0x3100 CRU:  48 Lnk:  1 EP:0 | SPages:  31 Pages:  7096 TFs:     8 with   2048 HBF in   31 blocks (0 err)</div><div class="line">L8   | Spec:0x3145731  FEE:0x3200 CRU:  48 Lnk:  2 EP:0 | SPages:  31 Pages:  7696 TFs:     8 with   2048 HBF in   31 blocks (0 err)</div><div class="line">L9   | Spec:0x3211265  FEE:0x3001 CRU:  49 Lnk:  0 EP:0 | SPages:  31 Pages:  7096 TFs:     8 with   2048 HBF in   31 blocks (0 err)</div><div class="line">L10  | Spec:0x3211266  FEE:0x3101 CRU:  49 Lnk:  1 EP:0 | SPages:  31 Pages:  7096 TFs:     8 with   2048 HBF in   31 blocks (0 err)</div><div class="line">L11  | Spec:0x3211267  FEE:0x3201 CRU:  49 Lnk:  2 EP:0 | SPages:  31 Pages:  7696 TFs:     8 with   2048 HBF in   31 blocks (0 err)</div><div class="line">Largest super-page: 1047008 <a class="code" href="../../d3/d1a/classB.html">B</a>, largest <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a632fb3c4852a7511229017553bf7dc32">TF</a>: 4070048 <a class="code" href="../../d3/d1a/classB.html">B</a></div><div class="line">Real <a class="code" href="../../d6/daa/namespaceGPUCA__NAMESPACE_1_1gpu_1_1deprecated.html#a43c7043263ca7d53795ab0e63729b653">time</a> 0:00:00, CP <a class="code" href="../../d6/daa/namespaceGPUCA__NAMESPACE_1_1gpu_1_1deprecated.html#a43c7043263ca7d53795ab0e63729b653">time</a> 0.120</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Jan 28 2020 13:41:52 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
